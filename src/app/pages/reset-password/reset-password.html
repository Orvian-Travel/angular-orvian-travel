<div class="container-fluid p-0">
  <div class="row no-gutters min-vh-100">
    <div
      class="col-12 col-lg-6 bg-white d-flex flex-column align-items-center justify-content-center p-3 p-md-4 order-2 order-lg-1"
    >
      <div class="d-flex flex-column align-items-center w-100">
        <img
          src="assets/images/draw-1.svg"
          alt="Ilustração"
          class="img-fluid mobile-illustration"
        />
      </div>
      <div class="text-container text-center text-lg-left w-100 mobile-text">
        <h2 class="h4 h-lg-3 font-weight-bold mb-2">Defina sua nova senha</h2>
        <p class="text-muted mobile-description">
          Escolha uma senha forte e segura para proteger sua conta na Orvian
          Travel.
        </p>
      </div>
    </div>

    <div
      class="col-12 col-lg-6 bg-gradient-custom d-flex align-items-center justify-content-center p-3 p-md-4 order-1 order-lg-2 mobile-form-container"
    >
      <div class="position-absolute mobile-back-btn d-lg-none">
        <button class="btn btn-custom-brown" (click)="backToLogin()">
          Voltar
        </button>
      </div>

      <div class="card shadow border-0 mobile-card">
        <div class="card-body p-3 p-md-4">
          <div
            *ngIf="message"
            class="alert mb-3"
            [ngClass]="{
              'alert-success': isSuccess,
              'alert-danger': !isSuccess
            }"
          >
            {{ message }}
          </div>

          <form *ngIf="!isSuccess && token" (ngSubmit)="onSubmit()">
            <div class="form-group mb-3">
              <label for="newPassword" class="form-label-custom"
                >NOVA SENHA</label
              >
              <div class="password-input-container">
                <input
                  [type]="showPassword ? 'text' : 'password'"
                  id="newPassword"
                  class="form-control form-control-custom password-input"
                  placeholder="Mínimo 8 caracteres"
                  [(ngModel)]="newPassword"
                  name="newPassword"
                  required
                  minlength="8"
                  [disabled]="isLoading"
                />
                <button
                  type="button"
                  class="password-toggle-btn"
                  (click)="togglePasswordVisibility()"
                  [attr.aria-label]="
                    showPassword ? 'Ocultar senha' : 'Mostrar senha'
                  "
                >
                  <i
                    class="fas"
                    [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"
                  ></i>
                </button>
              </div>
            </div>

            <div class="form-group mb-4">
              <label for="confirmPassword" class="form-label-custom"
                >CONFIRMAR SENHA</label
              >
              <input
                type="password"
                id="confirmPassword"
                class="form-control form-control-custom"
                placeholder="Digite a senha novamente"
                [(ngModel)]="confirmPassword"
                name="confirmPassword"
                required
                [disabled]="isLoading"
              />
            </div>

            <div *ngIf="newPassword" class="password-strength mb-3">
              <small class="text-muted">Força da senha:</small>
              <div class="progress" style="height: 4px">
                <div
                  class="progress-bar"
                  [style.width.%]="getPasswordStrength()"
                  [ngClass]="getPasswordStrengthClass()"
                ></div>
              </div>
              <small
                class="password-strength-text"
                [ngClass]="getPasswordStrengthClass()"
              >
                {{ getPasswordStrengthText() }}
              </small>
            </div>

            <button
              class="btn btn-custom-primary w-100 mb-3"
              type="submit"
              [disabled]="
                isLoading ||
                !newPassword ||
                !confirmPassword ||
                newPassword !== confirmPassword
              "
            >
              <span
                *ngIf="isLoading"
                class="spinner-border spinner-border-sm me-2"
              ></span>
              {{ isLoading ? "Redefinindo..." : "Redefinir senha" }}
            </button>
          </form>

          <div *ngIf="!token" class="text-center">
            <p class="text-danger mb-3">
              Token de redefinição inválido ou expirado.
            </p>
            <button
              class="btn btn-custom-primary w-100"
              (click)="backToLogin()"
            >
              Voltar ao login
            </button>
          </div>

          <div *ngIf="isSuccess" class="text-center">
            <button
              class="btn btn-custom-primary w-100"
              (click)="backToLogin()"
            >
              Ir para o login
            </button>
          </div>

          <div *ngIf="!isSuccess && token" class="text-center">
            <p class="mb-0">
              <span class="login-text">Lembrou da senha?</span>
              <a class="login-link-action" (click)="backToLogin()">
                Fazer login
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
