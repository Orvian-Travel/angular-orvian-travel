<main class="container my-5">
  <div class="section-header">
    <h2 class="section-title">{{ cardListTitle }}</h2>
    <p class="section-subtitle">
      Descubra destinos incríveis com os melhores preços
    </p>
    <button (click)="limparBusca()" class="btnClear mt-2" *ngIf="isSearching">
      Limpar Busca
    </button>
  </div>
  <div class="packages-grid">
    <div
      class="package-card"
      *ngFor="let package of packages"
    >
      <div class="card-image-wrapper" (click)="navigateToDetails(package.id)">
        <img
          [src]="getPackageImageUrl(package)"
          class="card-image"
          alt="{{ package.title }}"
        />
        <div class="duration-badge">
          <span>{{ package.duration }} dias</span>
        </div>
      </div>
      <div class="card-content">
        <div class="package-tag">{{ package.maxPeople }} pessoas</div>
        <h3 class="package-title" (click)="navigateToDetails(package.id)">{{ package.title }}</h3>
        
        <!-- Nova seção de avaliações -->
        <div class="ratings-section">
          <div class="ratings-summary" (click)="openRatingsModal(package.id, package.title)">
            <div class="stars-display">
              <mat-icon 
                *ngFor="let star of generateStars(package.averageRating || 0)"
                [class.filled]="star === 1"
                class="star-icon"
              >
                star
              </mat-icon>
            </div>
            <span class="rating-text">
              {{ package.averageRating ? (package.averageRating | number: '1.1-1') : 'Sem avaliações' }}
              <span *ngIf="package.totalRatings && package.totalRatings > 0" class="ratings-count">
                ({{ package.totalRatings }} avaliação{{ package.totalRatings !== 1 ? 'ões' : '' }})
              </span>
            </span>
            <mat-icon class="view-icon">visibility</mat-icon>
          </div>
        </div>

        <div class="price-section">
          <span class="price-label">A partir de</span>
          <div class="price-wrapper">
            <span class="currency">R$</span>
            <span class="price">{{
              package.price | number : "1.2-2" : "pt-BR"
            }}</span>
            <span class="price-period">/pessoa</span>
          </div>
          <p class="price-disclaimer">*Taxas não incluídas</p>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="totalPages > 1" class="pagination-container">
    <nav class="pagination-nav">
      <button
        class="pagination-btn pagination-prev"
        [disabled]="currentPage === 0"
        (click)="previousPage()"
      >
        Anterior
      </button>
      <div class="pagination-numbers">
        <button
          *ngFor="let page of [].constructor(totalPages); let i = index"
          class="pagination-number"
          [class.active]="i === currentPage"
          (click)="goToPage(i)"
        >
          {{ i + 1 }}
        </button>
      </div>
      <button
        class="pagination-btn pagination-next"
        [disabled]="currentPage === totalPages - 1"
        (click)="nextPage()"
      >
        Próximo
      </button>
    </nav>
    <div class="pagination-info">
      Página {{ currentPage + 1 }} de {{ totalPages }} ({{ totalElements }}
      pacotes no total)
    </div>
  </div>
</main>

<!-- Modal de Avaliações -->
<app-package-ratings-viewer
  [packageId]="selectedPackageId"
  [packageTitle]="selectedPackageTitle"
  [isVisible]="isRatingsModalVisible"
  (close)="closeRatingsModal()"
></app-package-ratings-viewer>
