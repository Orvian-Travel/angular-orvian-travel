<!-- FormulÃ¡rio de AvaliaÃ§Ã£o -->
<div class="rating-form-container">
  <div class="rating-form-header">
    <h3 class="form-title">
      {{ existingRating ? 'Editar AvaliaÃ§Ã£o' : 'Avaliar ExperiÃªncia' }}
    </h3>
    <p class="form-subtitle">
      {{ existingRating ? 'Modifique sua avaliaÃ§Ã£o ou delete-a se desejar' : 'Compartilhe sua experiÃªncia e ajude outros viajantes' }}
    </p>
    
    <!-- Indicador visual de avaliaÃ§Ã£o existente -->
    <div *ngIf="existingRating" class="existing-rating-indicator">
      <div class="indicator-icon">âœï¸</div>
      <span class="indicator-text">VocÃª jÃ¡ avaliou este pacote. Pode editar ou deletar sua avaliaÃ§Ã£o.</span>
    </div>
  </div>

  <form [formGroup]="ratingForm" (ngSubmit)="onSubmit()" class="rating-form">
    
    <!-- SeÃ§Ã£o de Estrelas -->
    <div class="form-group">
      <label class="form-label">Sua nota *</label>
      <div class="stars-container">
        <button
          type="button"
          *ngFor="let star of [1,2,3,4,5]"
          class="star-button"
          [class]="getStarClass(star)"
          (click)="setRating(star)"
          (mouseenter)="setHoverRating(star)"
          (mouseleave)="clearHoverRating()"
          [attr.aria-label]="'Dar ' + star + ' estrela' + (star > 1 ? 's' : '')">
          â˜…
        </button>
      </div>
      <div class="rating-text" *ngIf="selectedRating > 0">
        <span [ngSwitch]="selectedRating">
          <span *ngSwitchCase="1">ğŸ˜ Muito ruim</span>
          <span *ngSwitchCase="2">ğŸ˜ Ruim</span>
          <span *ngSwitchCase="3">ğŸ™‚ Regular</span>
          <span *ngSwitchCase="4">ğŸ˜Š Bom</span>
          <span *ngSwitchCase="5">ğŸ˜ Excelente</span>
        </span>
      </div>
      <div class="error-message" *ngIf="hasFieldError('rate')">
        {{ getFieldError('rate') }}
      </div>
    </div>

    <!-- SeÃ§Ã£o de ComentÃ¡rio -->
    <div class="form-group">
      <label for="comment" class="form-label">Seu comentÃ¡rio *</label>
      <textarea
        id="comment"
        formControlName="comment"
        class="form-textarea"
        [class.error]="hasFieldError('comment')"
        placeholder="Conte-nos sobre sua experiÃªncia... O que mais gostou? O que poderia melhorar?"
        rows="5">
      </textarea>
      <div class="textarea-footer">
        <div class="char-counter" [class.warning]="getRemainingChars() < 50">
          {{ getRemainingChars() }} caracteres restantes
        </div>
      </div>
      <div class="error-message" *ngIf="hasFieldError('comment')">
        {{ getFieldError('comment') }}
      </div>
    </div>

    <!-- Mensagem de Erro Geral -->
    <div class="submit-error" *ngIf="submitError">
      <div class="error-icon">âš ï¸</div>
      <div class="error-text">{{ submitError }}</div>
    </div>

    <!-- Mensagem de Erro de Delete -->
    <div class="delete-error" *ngIf="deleteError">
      <div class="error-icon">âš ï¸</div>
      <div class="error-text">{{ deleteError }}</div>
    </div>

    <!-- BotÃµes de AÃ§Ã£o -->
    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="onCancel()"
        [disabled]="isSubmitting || isDeleting">
        Cancelar
      </button>

      <!-- BotÃ£o de Deletar (sÃ³ aparece se hÃ¡ avaliaÃ§Ã£o existente) -->
      <button
        *ngIf="existingRating"
        type="button"
        class="btn btn-danger btn-delete"
        (click)="showDeleteConfirmationDialog()"
        [disabled]="isSubmitting || isDeleting"
        title="Deletar esta avaliaÃ§Ã£o permanentemente">
        <span class="delete-icon">ğŸ—‘ï¸</span>
        <span *ngIf="isDeleting" class="loading-spinner"></span>
        <span class="delete-text">{{ isDeleting ? 'Deletando...' : 'Deletar' }}</span>
      </button>
      
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="ratingForm.invalid || isSubmitting || isDeleting">
        <span *ngIf="isSubmitting" class="loading-spinner"></span>
        {{ isSubmitting ? 'Salvando...' : (existingRating ? 'Atualizar AvaliaÃ§Ã£o' : 'Enviar AvaliaÃ§Ã£o') }}
      </button>
    </div>

  </form>
</div>

<!-- Modal de ConfirmaÃ§Ã£o de Delete -->
<div *ngIf="showDeleteConfirmation" class="delete-modal-overlay" (click)="cancelDelete()">
  <div class="delete-modal-container" (click)="$event.stopPropagation()">
    <div class="delete-modal-header">
      <div class="delete-modal-icon">ğŸ—‘ï¸</div>
      <h3 class="delete-modal-title">Deletar AvaliaÃ§Ã£o</h3>
    </div>
    
    <div class="delete-modal-content">
      <p class="delete-warning-text">
        Tem certeza que deseja <strong>deletar permanentemente</strong> sua avaliaÃ§Ã£o?
      </p>
      
      <!-- PrÃ©via da avaliaÃ§Ã£o que serÃ¡ deletada -->
      <div *ngIf="existingRating" class="rating-preview">
        <div class="preview-rating">
          <span *ngFor="let star of [1,2,3,4,5]" 
                class="preview-star" 
                [class.filled]="star <= existingRating.rate">
            â­
          </span>
          <span class="preview-rate">({{ existingRating.rate }}/5)</span>
        </div>
        <div class="preview-comment">
          "{{ existingRating.comment }}"
        </div>
      </div>
      
      <p class="delete-warning-subtext">
        âš ï¸ Esta aÃ§Ã£o nÃ£o pode ser desfeita.
      </p>
      
      <!-- Mensagem de erro especÃ­fica do delete -->
      <div class="delete-error" *ngIf="deleteError">
        <div class="error-icon">âš ï¸</div>
        <div class="error-text">{{ deleteError }}</div>
      </div>
    </div>
    
    <div class="delete-modal-actions">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="cancelDelete()"
        [disabled]="isDeleting">
        Cancelar
      </button>
      
      <button
        type="button"
        class="btn btn-danger btn-delete-confirm"
        (click)="confirmDelete()"
        [disabled]="isDeleting">
        <span class="delete-icon">ğŸ—‘ï¸</span>
        <span *ngIf="isDeleting" class="loading-spinner"></span>
        <span>{{ isDeleting ? 'Deletando...' : 'Sim, Deletar' }}</span>
      </button>
    </div>
  </div>
</div>
